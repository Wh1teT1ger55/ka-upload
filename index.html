<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMG Klassenarbeiten</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@1/web/uc-file-uploader-regular.min.css">
</head>
<body>
    <div class="logo-schrift">
        <img src="https://www.lmg-remseck.de/sites/default/files/logo/lmg-logo-42.png" id="logo">
        <h1 id="title">Klassenarbeiten des LMG</h1>
    </div>

    <img src="https://www.lmg-remseck.de/themes/lmgbootstrap/bg.jpg" id="lmg-bild">
    <section id="main-content">
    <h1>Über diese Seite</h1>
    <p>
       Diese Seite wurde von Schülern des LMGs entworfen und beinhaltet sämtliche alte Klassenarbeiten von Lehrern. 
       Manche Arbeiten werden von Lehrern mehrmals verwendet, darum können diese teilweise hilfreich für kommende Arbeiten sein, 
       wobei nicht garantiert werden kann, dass die Arbeiten auf dieser Website genau so wieder drankommen werden. 
       Sofern man Schüler des LMGs ist und eine Klassenarbeit zuhause hat, die noch nicht auf der Website zu finden ist, dann kann diese hier hochgeladen werden.
    </p>
    <h1>Klasse:</h1>
    <p>
        <label><input type="radio" name="klasse" class="klasse" value="k5">5</label>
        <label><input type="radio" name="klasse" class="klasse" value="k6">6</label>
        <label><input type="radio" name="klasse" class="klasse" value="k7">7</label>
        <label><input type="radio" name="klasse" class="klasse" value="k8">8</label>
        <label><input type="radio" name="klasse" class="klasse" value="k9">9</label>
        <label><input type="radio" name="klasse" class="klasse" value="k10">10</label>
    </p>

    <h1>Fach:</h1>
    <p>
        <label><input type="checkbox" class="fach" value="mat">Mathe</label>
        <label><input type="checkbox" class="fach" value="deu">Deutsch</label>
        <label><input type="checkbox" class="fach" value="eng">Englisch</label>
        <label><input type="checkbox" class="fach" value="lat">Latein</label>
        <label><input type="checkbox" class="fach" value="fra">Franz</label>
        <label><input type="checkbox" class="fach" value="spa">Spanisch</label>
        <label><input type="checkbox" class="fach" value="nwt">NWT</label>
        <label><input type="checkbox" class="fach" value="phy">Physik</label>
        <label><input type="checkbox" class="fach" value="che">Chemie</label>
        <label><input type="checkbox" class="fach" value="bio">Bio</label>
        <label><input type="checkbox" class="fach" value="geo">Geo</label>
        <label><input type="checkbox" class="fach" value="wbs">WBS</label>
        <label><input type="checkbox" class="fach" value="gk">GK</label>
        <label><input type="checkbox" class="fach" value="gesch">Geschichte</label>
    </p>

    <h1>Dateien Hochladen</h1>
    <uc-config
      ctx-name="my-uploader"
      pubkey="39df1b37835506464216"
      multiple
      multiple-min="1"
      multiple-max="10"
      img-only
    ></uc-config>   
    <form id="upload-file">
        <label for="klasse">Klasse:</label><br />
        <select name="klasse" id="klasse" form="upload-file">
            <option value="k5">5</option>
            <option value="k6">6</option>
            <option value="k7">7</option>
            <option value="k8">8</option>
            <option value="k9">9</option>
            <option value="k10">10</option>
            <option value="k11">11</option>
        </select>
        <select name="fach" id="fach">
            <option value="mat">Mathe</option>
            <option value="deu">Deutsch</option>
            <option value="eng">Englisch</option>
            <option value="lat">Latein</option>
            <option value="fra">Französisch</option>
            <option value="spa">Spanisch</option>
            <option value="nwt">NWT</option>
            <option value="phy">Physik</option>
            <option value="che">Chemie</option>
            <option value="bio">Biologie</option>
            <option value="geo">Geographie</option>
            <option value="wbs">Wirtschaft und Recht</option>
            <option value="gk">Gesellschaftskunde</option>
            <option value="gesch">Geschichte</option>
        </select>
        <select name="lehrer" id="lehrer">
            <option value="piller">Herr Piller</option>
            <option value="hohn">Frau Hohn</option>
            <option value="bauer1">Herr Bauer (der Alte)</option>
            <option value="bauer2">Herr Bauer (der Neue)</option>
        </select>

        <!-- Uploadcare File Uploader -->
        <uc-file-uploader-regular ctx-name="my-uploader">
            <uc-form-input ctx-name="my-uploader"></uc-form-input>
        </uc-file-uploader-regular>
        <button type="submit">Submit</button>
    </form> 

    <h3>Arbeiten:</h3>
    <div id="gallery"></div>
    <div id="texte">
        <p class="k5 mat hidden" name="arbeit" data-lehrer="piller" data-thema="Thema1"><a href="/C:/Users/lukas/Documents/Schule/Englisch/fertig/Tyroller-Lukas-Englisch-Workbook p.45.pdf" target="_blank">Test-Datei</a></p>
        <p class="k5 deu hidden" name="arbeit" data-lehrer="hohn" data-thema="Thema2">Test 2</p>
        <p class="k5 eng hidden" name="arbeit" data-lehrer="bauer1" data-thema="Thema3">Test 3</p>
        <p class="k5 eng hidden" name="arbeit" data-lehrer="bauer1" data-thema="Thema4">Test 4</p>
        <p class="k10 mat hidden" name="arbeit" data-lehrer="bauer2" data-thema="Thema5">Test 5</p>
        <p class="k10 deu hidden" name="arbeit" data-lehrer="piller" data-thema="Thema6">Test 6</p>
        <p class="k6 fra hidden" name="arbeit" data-lehrer="hohn" data-thema="Thema7">Test 7</p>
    </div>
   <script type="module">
        import * as LR from "https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@1/web/uc-file-uploader-regular.min.js";
        LR.defineComponents(LR);
        const form = document.querySelector("form");
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const klasse = formData.get("klasse");
            const fach = formData.get("fach");
            const lehrer = formData.get("lehrer");
            const url = formData.getAll("my-uploader[]")
            url.forEach((url) => {
                // Hier wird die URL verarbeitet und das Bild in die Galerie eingefügt
                const uuid = url.replace("https://ucarecdn.com/", "").replace("/", "");
                appendImage(url, 'gallery', uuid, klasse, fach, lehrer);
            });
            // Nur für Debugging
            console.log("Klasse:", klasse);
            console.log("Fach:", fach);
            console.log("Lehrer:", lehrer);
            console.log("Link:", url);
        });
        function appendImage(imageSource, Id, imageId, klasse, fach, lehrer) {
            var img = document.createElement("IMG");
            img.src = imageSource;
            img.setAttribute('id', imageId);
            img.classList.add(klasse, fach, "hidden");
            img.setAttribute('data-author', lehrer);
            img.setAttribute('name', 'arbeit');
            img.setAttribute('width', '200px');
            img.setAttribute('onclick', 'window.open(this.src)');
            document.getElementById(Id).appendChild(img);
            return imageId;
        }

        function removeImage(imageId) {
            var elementToBeRemoved = document.getElementById(imageId);
            elementToBeRemoved.parentNode.removeChild(elementToBeRemoved);
        }


        
    </script>
    <script>
        const klasseRadios = document.querySelectorAll('.klasse');
        const fachCheckboxes = document.querySelectorAll('.fach');

        let aktiveKlasse = null;

        const autorMap = {
            "piller": "Herr Piller",
            "hohn": "Frau Hohn",
            "bauer1": "Herr Bauer (der Alte)",
            "bauer2": "Herr Bauer (der Neue)"
        }

        // Klassen-Filter (erster Schritt)
        klasseRadios.forEach(radio => {
            radio.addEventListener('change', () => {
            aktiveKlasse = radio.value;
            updateAnzeige();
            });
        });

        // Fächer-Filter (zweiter Schritt)
        fachCheckboxes.forEach(cb => {
            cb.addEventListener('change', updateAnzeige);
        });
        
        function updateAnzeige() {
            const aktiveFaecher = Array.from(fachCheckboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.value);

            document.querySelectorAll('.arbeit-wrapper').forEach(el => el.remove());

            texte.forEach(p => {
                const passtZurKlasse = aktiveKlasse && p.classList.contains(aktiveKlasse);
                const passtZuFach = aktiveFaecher.length === 0 || aktiveFaecher.some(fach => p.classList.contains(fach));
                p.classList.add('hidden');

                if (passtZurKlasse && passtZuFach) {
                    const wrapper = document.createElement("div");
                    wrapper.classList.add("arbeit-wrapper");

                    const lehrer = document.createElement("p");
                    const thema = document.createElement("p");
                    lehrer.classList.add("beschreibung");
                    thema.classList.add("beschreibung");
                    lehrer.textContent = "Lehrer: " + (lehrerMap[p.getAttribute("data-lehrer")] || "unbekannt");
                    thema.textContent = "Thema: " + (p.getAttribute("data-thema") || "unbekannt");

                    const clone = p.cloneNode(true);
                    clone.classList.remove("hidden");

                    wrapper.appendChild(clone);
                    wrapper.appendChild(lehrer);
                    wrapper.appendChild(thema);
                    p.parentElement.appendChild(wrapper);
                } 
            });
        }
  </script>
</body>
</html>