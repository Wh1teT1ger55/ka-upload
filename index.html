<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMG Klassenarbeiten</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@1/web/uc-file-uploader-regular.min.css">
</head>
<body>

    <h2 id="title">Lise Meitner Gymansium</h2>
    <!--Wie es scheint ist das Menu nicht von Nöten, ich habs jetzt aber erst mal drin gelassen-->
    <div class="container">
        <ul id="main">
            <li><a href="#fach">Fächer</a></li>
            <li><a href="#lehrer">Lehrer</a></li>
        </ul>
    </div>
    
    <h2>Über diese Seite</h2>
    <p>
       Diese Seite wurde von Schülern des LMGs entworfen und beinhaltet sämtliche alte Klassenarbeiten von Lehrern. 
       Sofern man eine Klassenarbeit der Website hinzufügen will, muss man sich registrieren mit einem Code den man 
       nur an der Schule bekommt (anzusprechenden Schüler: )
    </p>
    <h3>Klasse:</h3>
    <p>
        <label><input type="radio" name="klasse" class="klasse" value="k5">5</label>
        <label><input type="radio" name="klasse" class="klasse" value="k6">6</label>
        <label><input type="radio" name="klasse" class="klasse" value="k7">7</label>
        <label><input type="radio" name="klasse" class="klasse" value="k8">8</label>
        <label><input type="radio" name="klasse" class="klasse" value="k9">9</label>
        <label><input type="radio" name="klasse" class="klasse" value="k10">10</label>
    </p>

    <h3>Fach:</h3>
    <p>
        <label><input type="checkbox" class="fach" value="mat">Mathe</label>
        <label><input type="checkbox" class="fach" value="deu">Deutsch</label>
        <label><input type="checkbox" class="fach" value="eng">Englisch</label>
        <label><input type="checkbox" class="fach" value="lat">Latein</label>
        <label><input type="checkbox" class="fach" value="fra">Franz</label>
        <label><input type="checkbox" class="fach" value="spa">Spanisch</label>
        <label><input type="checkbox" class="fach" value="nwt">NWT</label>
        <label><input type="checkbox" class="fach" value="phy">Physik</label>
        <label><input type="checkbox" class="fach" value="che">Chemie</label>
        <label><input type="checkbox" class="fach" value="bio">Bio</label>
        <label><input type="checkbox" class="fach" value="geo">Geo</label>
        <label><input type="checkbox" class="fach" value="wbs">WBS</label>
        <label><input type="checkbox" class="fach" value="gk">GK</label>
        <label><input type="checkbox" class="fach" value="gesch">Geschichte</label>
    </p>

    <h1>Dateien Hochladen</h1>
    <uc-config
      ctx-name="my-uploader"
      pubkey="39df1b37835506464216"
      multiple
      multiple-min="1"
      multiple-max="10"
      img-only
    ></uc-config>   
    <form id="upload-file">
        <label for="klasse">Klasse:</label><br />
        <select name="klasse" id="klasse" form="upload-file">
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
        </select>
        <select name="fach" id="fach">
            <option value="mat">Mathe</option>
            <option value="deu">Deutsch</option>
            <option value="eng">Englisch</option>
            <option value="lat">Latein</option>
            <option value="fra">Französisch</option>
            <option value="spa">Spanisch</option>
            <option value="nwt">NWT</option>
            <option value="phy">Physik</option>
            <option value="che">Chemie</option>
            <option value="bio">Biologie</option>
            <option value="geo">Geographie</option>
            <option value="wbs">Wirtschaft und Recht</option>
            <option value="gk">Gesellschaftskunde</option>
            <option value="gesch">Geschichte</option>
        </select>
        <select name="lehrer" id="lehrer">
            <option value="piller">Herr Piller</option>
            <option value="hohn">Frau Hohn</option>
            <option value="bauer1">Herr Bauer (der Alte)</option>
            <option value="bauer2">Herr Bauer (der Neue)</option>
        </select>

        <!-- Uploadcare File Uploader -->
        <uc-file-uploader-regular ctx-name="my-uploader">
            <uc-form-input ctx-name="my-uploader"></uc-form-input>
        </uc-file-uploader-regular>
        <button type="submit">Submit</button>

        <!-- Nur für Debugging --> 
        <code>
            <pre id="form-output"></pre>
        </code>
    </form> 

    <h3>Arbeiten:</h3>
    <div id="gallery"></div>
    <div id="texte">
        <p class="k5 mat hidden" name="arbeit" data-author="piller"><a href="/C:/Users/lukas/Documents/Schule/Englisch/fertig/Tyroller-Lukas-Englisch-Workbook p.45.pdf" target="_blank">Test-Datei</a></p>
        <p class="k5 deu hidden" name="arbeit" data-author="hohn">Test 2</p>
        <p class="k5 eng hidden" name="arbeit" data-author="bauer1">Test 3</p>
        <p class="k10 mat hidden" name="arbeit" data-author="bauer2">Test 4</p>
        <p class="k10 deu hidden" name="arbeit" data-author="piller">Test 5</p>
        <p class="k6 fra hidden" name="arbeit" data-author="bauer1">Test 6</p>
    </div>
   <script type="module">
        import * as LR from "https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@1/web/uc-file-uploader-regular.min.js";
        LR.defineComponents(LR);
        const form = document.querySelector("form");
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const klasse = formData.get("klasse");
            const fach = formData.get("fach");
            const lehrer = formData.get("lehrer");
            const url = formData.get("my-uploader[]")
            const uuid = url.replace("https://ucarecdn.com/", "").replace("/", "");
            appendImage(url, 'gallery', uuid, klasse, fach, lehrer);
            console.log("Klasse:", klasse);
            console.log("Fach:", fach);
            console.log("Lehrer:", lehrer);
            console.log("Link:", url);
            // Nur für Debugging
            const outputEl = document.querySelector("#form-output");
            outputEl.innerText = JSON.stringify([...formData.entries()], null, 2);
        });

        function appendImage(imageSource, Id, imageId, klasse, fach, lehrer) {
            var img = document.createElement("IMG");
            img.src = imageSource;
            img.setAttribute('id', imageId);
            img.classList.add(klasse, fach, "hidden");
            img.setAttribute('data-author', lehrer);
            document.getElementById(Id).appendChild(img);
            return imageId;
        }

        function removeImage(imageId) {
            var elementToBeRemoved = document.getElementById(imageId);
            elementToBeRemoved.parentNode.removeChild(elementToBeRemoved);
        }


        
    </script>
    <script>
        const klasseRadios = document.querySelectorAll('.klasse');
        const fachCheckboxes = document.querySelectorAll('.fach');
        const texte = document.querySelectorAll('#texte p');

        let aktiveKlasse = null;

        const autorMap = {
            "piller": "Herr Piller",
            "hohn": "Frau Hohn",
            "bauer1": "Herr Bauer (der Alte)",
            "bauer2": "Herr Bauer (der Neue)"
        }

        // Klassen-Filter (erster Schritt)
        klasseRadios.forEach(radio => {
            radio.addEventListener('change', () => {
            aktiveKlasse = radio.value;
            updateAnzeige();
            });
        });

        // Fächer-Filter (zweiter Schritt)
        fachCheckboxes.forEach(cb => {
            cb.addEventListener('change', updateAnzeige);
        });
        
        function updateAnzeige() {
            const aktiveFaecher = Array.from(fachCheckboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.value);

            texte.forEach(p => {
                const passtZurKlasse = aktiveKlasse && p.classList.contains(aktiveKlasse);
                const passtZuFach = aktiveFaecher.length === 0 || aktiveFaecher.some(fach => p.classList.contains(fach));
                const nextElem = p.nextElementSibling;
                if (nextElem && nextElem.classList.contains("beschreibung")) {
                    nextElem.remove();
                }

            if (passtZurKlasse && passtZuFach) {
                p.classList.remove('hidden');
                const beschreibung = document.createElement("p");
                beschreibung.classList.add("beschreibung");
                beschreibung.textContent = "Lehrer: " + (autorMap[p.getAttribute("data-author")] || "unbekannt");
                p.insertAdjacentElement("afterend", beschreibung);
            } 
            else {
                p.classList.add('hidden');
            }
            });
        }
  </script>
</body>
</html>
